; =============================================================================
; Supervisor Configuration for KYC-AML Agentic AI Orchestrator
; =============================================================================
; This file goes in: /etc/supervisor/conf.d/kyc-aml-orchestrator.conf
;
; Commands:
;   supervisorctl reread
;   supervisorctl update
;   supervisorctl start kyc-aml-orchestrator
;   supervisorctl status kyc-aml-orchestrator
;   supervisorctl restart kyc-aml-orchestrator
; =============================================================================

[program:kyc-aml-orchestrator]
; Application command - runs Streamlit
command=/opt/kyc-aml-orchestrator/.venv/bin/streamlit run web_chat.py --server.port=8501 --server.address=0.0.0.0 --server.headless=true --browser.gatherUsageStats=false

; Working directory
directory=/opt/kyc-aml-orchestrator

; Run as application user
user=kycaml

; Auto-start and restart settings
autostart=true
autorestart=true
startsecs=10
startretries=3

; Stop settings
stopwaitsecs=30
stopasgroup=true
killasgroup=true

; Logging
stdout_logfile=/var/log/kyc-aml-orchestrator/app.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/var/log/kyc-aml-orchestrator/error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
redirect_stderr=false

; Environment variables (API keys should be in .env file, not here)
environment=
    HOME="/opt/kyc-aml-orchestrator",
    PATH="/opt/kyc-aml-orchestrator/.venv/bin:/usr/local/bin:/usr/bin:/bin",
    PYTHONUNBUFFERED="1"

; Process priority (lower = higher priority)
priority=999

; Number of processes (1 for Streamlit)
numprocs=1
